# CheckMissingChapters - Sigil 章节缺失检查插件

一个强大的 Sigil EPUB 编辑器插件，用于检测 EPUB 目录中的章节缺失、顺序异常和重复问题。

## ✨ 主要功能

### 章节检测
- **缺失章节检查** - 自动检测目录中缺失的章节号
- **顺序异常检测** - 识别章节跳跃和倒退（如：223→234、235→226）
- **重复章节检测** - 发现同一章节号出现多次的情况
- **自动分段检测** - 识别无卷标题但章节号重置的情况

### 数字类型支持
- 阿拉伯数字（1, 2, 3...）
- 中文小写（一二三...十百千万）
- 中文大写（壹贰叁...拾佰仟萬）
- 混合模式（自动识别所有类型）
- 变体字符（〇、两）

### 卷/部管理
- 支持分卷检测（第X卷、第X部）
- 三种编号模式：
  - 每卷从1开始
  - 每卷从0开始
  - 全书连续编号

### 缺失章节修复
- **插入占位符** - 在 nav.xhtml 中插入缺失章节占位符
  - 标记：`【★缺失★】第X章`
  - 自动指向最近的现有章节
- **删除占位符** - 一键清除所有插入的占位符
- 避免误删正常章节

### 详细分析报告
生成三个区块的完整报告：
1. **检测配置** - 前缀、后缀、数字类型、目录来源、检测模式
2. **目录分析** - 识别章节数、数字分布、变体字符、分卷情况、示例章节
3. **检查结果** - 缺失章节详情、顺序异常、重复章节

## 📦 安装

1. 下载最新版本的 `.zip` 文件
2. 在 Sigil 中：`Plugins` → `Manage Plugins` → `Add Plugin`
3. 选择下载的 zip 文件
4. 重启 Sigil

## 🚀 使用方法

### 基础使用
1. 打开 EPUB 文件
2. 运行插件：`Plugins` → `Edit` → `CheckMissingChapters`
3. 配置章节格式：
   - 前缀（如：第）
   - 数字类型（混合/阿拉伯/小写/大写）
   - 后缀（如：章/回/节/话/集）
4. 点击「开始检查」查看结果

### 高级功能

#### 自定义后缀
1. 在后缀下拉框中输入新后缀
2. 点击「添加后缀」保存
3. 后续可直接选择使用

#### 卷/部检测
1. 勾选「启用卷/部检测」
2. 设置卷正则表达式（如：`第\s*([0-9]+)\s*[卷部]`）
3. 选择编号模式

#### 自动分段
1. 勾选「自动检测章节重置」
2. 无需设置卷正则
3. 自动识别章节号从大变小的重置点

#### 插入缺失占位符
1. 先运行「开始检查」
2. 点击「插入缺失占位」
3. 确认后在 nav.xhtml 中插入带特殊标记的占位符
4. 如需撤销，点击「删除占位符」

## 📊 检测示例

### 输出格式
```
==================================================
📋 检测配置
==================================================
   前缀: 「第」
   后缀: 「章」
   数字类型: 中文小写
   目录来源: NAV
   检测模式: 全书

==================================================
📊 目录分析
==================================================
   识别章节数: 709
   数字分布: 中文小写 709
   变体字符: 有 (15 处，含〇或两)
   检测到分卷: 否
   示例章节:
      • 第一章 今日宜出行，不宜作弊
      • 第二章 单灵根
      • 第三章 一看就是老实人

==================================================
🔍 检查结果
==================================================
📌 📖 全书
   🔴 缺失 (2 章): 224, 225
   ℹ️  范围: 1 -> 709
   ⚠️  顺序异常 (4 处):
      • 223→234 (跳过10章)
      • 235→226 (倒退)
      • 233→224 (倒退)
      • 225→236 (跳过10章)
```

## 🛠️ 技术特性

- **EPUB2/3 兼容** - 支持 nav.xhtml（EPUB3）和 toc.ncx（EPUB2）
- **智能数字解析** - 处理复杂中文数字（如：一万二千三百四十五）
- **大数据优化** - 缺失章节超过30个时自动分组折叠
- **配置持久化** - 设置自动保存为 JSON 文件
- **Qt 跨版本** - 兼容 PyQt5、PySide6、PySide2

## 📝 版本历史

### v1.0.0 (2025-01-09)
- ✨ 新增顺序异常检测（跳跃/倒退）
- ✨ 新增重复章节检测
- 🐛 修复章节顺序混乱无法识别的问题

### v0.9.0
- ✨ 数字类型下拉选择（混合/阿拉伯/小写/大写）
- ✨ 详细的三段式分析报告
- 🐛 修复大写中文数字遗漏问题

### v0.8.0
- ✨ 插入缺失章节占位符功能
- ✨ 删除占位符功能
- 🎨 特殊标记：`【★缺失★】`

### v0.7.0
- ✨ 自动检测章节重置功能
- 🎨 支持无卷标题的分段检测

### v0.6.0
- 🎨 合并为单一 UI（设置+结果）
- 🌏 全面中文化
- 🎨 优化布局为 800x600

### v0.5.0
- 🎨 UI 重构
- ⚡ 添加 autostart 和 autoclose

### v0.4.0
- ✨ EPUB2 支持（toc.ncx）
- 🐛 优化中文数字转换

### v0.3.0
- 🎉 初始版本
- ✨ 基础章节缺失检测

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

## 📄 许可证

MIT License

## 👤 作者

Jules

---

**注意事项：**
- 插件基于目录文本内容检测，不检查文件名
- 建议在使用插入占位符功能前备份 EPUB
- 占位符可随时删除，不影响正常章节
